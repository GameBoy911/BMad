      Start([用户启动客户端]) --> A[OAuth.Desktop启动]

      A --> B[采集机器指纹]
      B --> B1[获取主板序列号]
      B --> B2[获取CPU ID]
      B --> B3[获取OS安装ID]

      B1 & B2 & B3 --> C[生成机器指纹Hash]

      C --> D[连接后端SignalR Hub]

      D --> E{连接成功?}
      E -->|否| F[等待重连<br/>5分钟后停止]
      E -->|是| G[发送验证请求]

      G --> H[后端验证卡密]
      H --> H1{卡密存在?}
      H1 -->|否| I[返回无授权]
      H1 -->|是| H2{卡密状态?}

      H2 -->|已过期| J[返回授权过期]
      H2 -->|已禁用| K[返回授权被禁用]
      H2 -->|已退款| L[返回已退款]
      H2 -->|已激活| M{机器指纹匹配?}

      M -->|否| N[返回机器不匹配]
      M -->|是| O[验证通过]

      O --> P[返回授权信息]
      P --> Q[客户端获得权限]
      Q --> R[开始心跳验证]

      R --> S[每1小时发送心跳]
      S --> T{心跳验证通过?}
      T -->|是| S
      T -->|否| U[锁定功能]

      I & J & K & L & N --> V[客户端功能受限]

      style O fill:#90EE90
      style V fill:#FFB6C1
      style U fill:#FFB6C1

  2. 后端与本地应用的执行流程图

  flowchart TD
      Start([用户创建工作流]) --> A[前端工作流构建器]

      A --> B[定义工作流步骤]
      B --> B1[选择脚本包]
      B --> B2[配置等待时间]
      B --> B3[设置账号切换]
      B --> B4[设置执行计划]

      B1 & B2 & B3 & B4 --> C[保存到后端]

      C --> D[后端验证]
      D --> D1{脚本包已审核?}
      D1 -->|否| E[拒绝创建]
      D1 -->|是| F[创建Hangfire任务]

      F --> G[等待触发时间]
      G --> H[Hangfire触发执行]

      H --> I[后端发送执行指令]
      I --> J[通过SignalR推送]

      J --> K[OAuth.Desktop接收]
      K --> L{需要切换账号?}

      L -->|是| M[切换到下一账号]
      L -->|否| N[保持当前账号]

      M --> N
      N --> O[请求脚本包文件]
      O --> P[后端返回文件内容]

      P --> Q[验证SHA256]
      Q --> Q1{验证通过?}
      Q1 -->|否| R[上报验证失败]
      Q1 -->|是| S[传递给守护程序]

      S --> T[守护程序执行]
      T --> T1{执行类型?}

      T1 -->|执行脚本| U[运行脚本文件]
      T1 -->|等待| V[延时等待]

      U --> W[收集执行结果]
      V --> W

      W --> X[返回给OAuth.Desktop]
      X --> Y[上报执行状态]

      Y --> Z[后端更新状态]
      Z --> AA[通知前端更新]

      AA --> AB{还有下一步?}
      AB -->|是| L
      AB -->|否| AC[工作流完成]

      R --> AD[工作流失败]

      style AC fill:#90EE90
      style AD fill:#FFB6C1
      style Q1 fill:#FFE4B5
      style L fill:#E6E6FA
